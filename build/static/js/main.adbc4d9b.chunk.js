(this.webpackJsonpepconnector=this.webpackJsonpepconnector||[]).push([[0],{103:function(e,t,a){},117:function(e,t){},119:function(e,t){},163:function(e,t){},184:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(18),s=a(31),i=(a(89),a(90),a(91),a(2)),o=a.n(i),u=a(5),l=a(19),p=a(6),d=a(8),h=a(9),f=a(11),m=a(10),b=a(3),j=a(84),g=a(1),v=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).onParameterChange=function(e,t){var a=t.currentTarget.value;n.setState((function(t){return{parameters:Object(p.a)(Object(p.a)({},t.parameters),{},Object(l.a)({},e,a))}}))},n.onConfigure=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.sdk.app.getCurrentState();case 2:return t=e.sent,e.abrupt("return",{parameters:n.state.parameters,targetState:t});case 4:case"end":return e.stop()}}),e)}))),n.state={parameters:{storeId:"",clientId:"",host:"api.moltin.com",productType:"product",selectedValue:"sku",itemsPerRequest:100,itemsPerPage:24,pcmChannel:"",pcmTag:""}},e.sdk.app.onConfigure((function(){return n.onConfigure()})),n}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,a=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.sdk.app.getParameters();case 2:t=e.sent,this.setState(t?{parameters:t}:this.state,(function(){a.props.sdk.app.setReady()}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(g.jsx)(b.q,{className:Object(j.a)({margin:"80px"}),children:Object(g.jsxs)(b.e,{children:[Object(g.jsx)(b.f,{children:"App Config"}),Object(g.jsx)(b.j,{children:"Enter your Elastic Path configuration in order to fetch products to be linked on your content."}),Object(g.jsx)(b.n,{required:!0,name:"clientId",id:"clientId",value:this.state.parameters.clientId||"",onChange:this.onParameterChange.bind(this,"clientId"),labelText:"Elastic Path Client ID",helpText:"Copy your Elastic Path Client ID and enter it here."}),Object(g.jsx)(b.n,{required:!0,name:"host",id:"host",value:this.state.parameters.host||"api.moltin.com",onChange:this.onParameterChange.bind(this,"host"),labelText:"Elastic Path host url",helpText:"Copy your Elastic Path host url and enter it here."}),Object(g.jsxs)(b.l,{required:!0,id:"productType",name:"productType",labelText:"Products Type",onChange:this.onParameterChange.bind(this,"productType"),helpText:"Select the ElasticPath Product catalog to pull from, legacy or pcm.",value:this.state.parameters.productType||"product",children:[Object(g.jsx)(b.i,{value:"product",children:"product (legacy)"}),Object(g.jsx)(b.i,{value:"pcm",children:"pcm"})]}),"pcm"===this.state.parameters.productType&&Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(b.n,{required:!0,name:"pcmChannel",id:"pcmChannel",value:this.state.parameters.pcmChannel||"",onChange:this.onParameterChange.bind(this,"pcmChannel"),labelText:"PCM Catalog Rule Channel",helpText:"Set the channel to set what PCM catalog to query from. See your Catalog Rules for configued channels"}),Object(g.jsx)(b.n,{required:!0,name:"pcmTag",id:"pcmTag",value:this.state.parameters.pcmTag||"",onChange:this.onParameterChange.bind(this,"pcmTag"),labelText:"PCM Catalog Rule Tag ",helpText:"Set the tag to set what PCM catalog to query from. See your Catalog Rules for configued tags."})]}),Object(g.jsxs)(b.l,{required:!0,id:"selectedValue",name:"selectedValue",labelText:"connector Value Type",onChange:this.onParameterChange.bind(this,"selectedValue"),helpText:"Choose whether Contentful stores the product Id, or SKU, of products selected through this integration.",value:this.state.parameters.selectedValue||"sku",children:[Object(g.jsx)(b.i,{value:"sku",children:"sku"}),Object(g.jsx)(b.i,{value:"id",children:"id"})]}),Object(g.jsx)(b.n,{required:!0,name:"itemsPerRequest",id:"itemsPerRequest",value:this.state.parameters.itemsPerRequest?this.state.parameters.itemsPerRequest.toString():"".concat(100),onChange:this.onParameterChange.bind(this,"itemsPerRequest"),labelText:"Items fetched per request (legacy catalog integration only)",helpText:"Number of products fetched from Elastic Path during product fetching."}),Object(g.jsx)(b.n,{required:!0,name:"itemsPerPage",id:"itemsPerPage",value:this.state.parameters.itemsPerPage?this.state.parameters.itemsPerPage.toString():"".concat(24),onChange:this.onParameterChange.bind(this,"itemsPerPage"),labelText:"Products per page",helpText:"Number of items displayed on product selection page."})]})})}}]),a}(n.Component),O=a(12),x=a(7),y=a(78),k=a.n(y),P=a(30),C=a.p+"static/media/image-placeholder.a504e5da.svg",w=function(e){return e&&""!==e?e:C},S=function(){var e=Object(u.a)(o.a.mark((function e(t,a){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dialogs.openCurrentApp({allowHeightOverflow:!0,position:"center",title:"Select Product",shouldCloseOnOverlayClick:!0,shouldCloseOnEscapePress:!0,parameters:Object(p.a)(Object(p.a)({},t.parameters.installation),{},{fieldValue:T(t.field.getValue()),fieldType:t.field.type,fieldId:t.field.id}),width:1400,minHeight:700});case 2:if(1!==(n=e.sent).length||""!==n[0]){e.next=9;break}return e.next=6,t.field.removeValue();case 6:a([]),e.next=18;break;case 9:if("Array"!==t.field.type){e.next=15;break}return e.next=12,t.field.setValue(n);case 12:a(n),e.next=18;break;case 15:return e.next=17,t.field.setValue(n[0]);case 17:a(n);case 18:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),T=function(e){return e?Array.isArray(e)?e:[e]:[]},N=function(e,t){var a=Object(n.useState)(""),r=Object(O.a)(a,2),c=r[0],s=r[1];return Object(n.useEffect)((function(){e&&!t.image&&t.imageFileId&&function(){var a=Object(u.a)(o.a.mark((function a(){return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.Files.Get(t.imageFileId).then((function(e){s(e.data.link.href)}));case 1:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}()()}),[e,t]),{imageUrl:t.image||c}},V=Object(P.c)((function(){return Object(g.jsx)(b.c,{className:"ep-card-handler",children:"Reorder product"})})),I=Object(P.b)((function(e){var t=e.product,a=e.isSortable,r=e.onDelete,c=Object(n.useContext)(ve).moltin,s=N(c,t).imageUrl,i=t.name||t.sku;return Object(g.jsxs)(b.b,{className:"ep-preview-wrapper",children:[a&&Object(g.jsx)(V,{}),Object(g.jsx)("div",{className:"ep-preview-image-wrapper",children:Object(g.jsx)("img",{className:"ep-preview-image",src:w(s),alt:i})}),Object(g.jsx)("section",{className:"ep-preview-section",children:Object(g.jsxs)(b.p,{children:[Object(g.jsx)(b.f,{className:"ep-preview-name",children:i}),Object(g.jsx)(b.m,{className:"ep-preview-connectorValue",children:t.connectorValue})]})}),Object(g.jsx)("div",{className:"ep-product-item-actions",children:Object(g.jsx)(b.h,{label:"Delete",iconProps:{icon:"Close"},buttonType:"muted",onClick:r})})]},"".concat(t.id,"-").concat(t.connectorValue))})),L=Object(P.a)((function(e){var t=e.deleteFn,a=e.productPreviews,n=a.length>1;return Object(g.jsx)("div",{children:a.map((function(e,a){return Object(g.jsx)(I,{product:e,onDelete:function(){return t(a)},isSortable:n,index:a},"".concat(e.id,"-").concat(e.connectorValue))}))})})),A=(a(103),a(38)),M=a(39),R=a(79),E=a.n(R),_=a(80),q=a.n(_),F=function(){var e=Object(u.a)(o.a.mark((function e(t){var a,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="pcm"===t.productType?Object(p.a)(Object(p.a)({},t.pcmChannel?{"EP-Channel":t.pcmChannel}:{}),t.pcmTag?{"EP-Context-Tag":t.pcmTag}:{}):{},r=Object(M.gateway)({client_id:t.clientId,host:null===(a=t.host)||void 0===a?void 0:a.replace("https://",""),headers:n}),e.next=4,r.Authenticate();case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(u.a)(o.a.mark((function e(t){var a,n,r,c,s,i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=E.a.create(),r="https://".concat(null===(a=t.host)||void 0===a?void 0:a.replace("https://","")),n.defaults.baseURL=r,e.next=5,n.post("/oauth/access_token",q.a.stringify({client_id:t.clientId,grant_type:"implicit"}),{headers:{"content-type":"application/x-www-form-urlencoded"}});case 5:return c=e.sent,s=c.data.access_token||"",i={Authorization:"Bearer: ".concat(s)},u="pcm"===t.productType?Object(p.a)(Object(p.a)({},t.pcmChannel?{"EP-Channel":t.pcmChannel}:{}),t.pcmTag?{"EP-Context-Tag":t.pcmTag}:{}):{},n.defaults.headers.common=Object(p.a)(Object(p.a)({},u),i),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function B(e,t){var a,n=[],r=Object(A.a)(e.data);try{for(r.s();!(a=r.n()).done;){var c,s,i,o,u=a.value,l={id:u.id,name:u.name,connectorValue:"sku"===t?u.sku:u.id,imageFileId:null===u||void 0===u||null===(c=u.relationships)||void 0===c||null===(s=c.main_image)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.id,image:e.included?U(u,null===(o=e.included)||void 0===o?void 0:o.main_images):null,sku:u.sku};n.push(l)}}catch(p){r.e(p)}finally{r.f()}return n}function U(e,t){var a=t.find((function(t){var a,n,r,c,s=(null===(a=e.relationships)||void 0===a?void 0:a.main_image)?null===(n=e.relationships)||void 0===n||null===(r=n.main_image)||void 0===r||null===(c=r.data)||void 0===c?void 0:c.id:null;return t.id===s}));return a?a.link.href:""}function z(e,t,a,n){var r={},c={};if(t&&""!==t){var s=t.replace(/[^\w\-\s]+/i,"");s=encodeURI("*".concat(t,"*")),r=Object(p.a)(Object(p.a)({},r),{},{like:{sku:s}})}return a&&""!==a&&(c=Object(p.a)(Object(p.a)({},c),{},{category:{id:a}})),n&&""!==n&&(c=Object(p.a)(Object(p.a)({},c),{},{collection:{id:n}})),r=Object(p.a)(Object(p.a)({},r),{},{eq:Object(p.a)({},c)})}var K=function(){var e=Object(u.a)(o.a.mark((function e(t,a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,a));case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function H(e,t){return G.apply(this,arguments)}function G(){return(G=Object(u.a)(o.a.mark((function e(t,a){var n,r,c,s,i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(a);case 2:return c=e.sent,s=null!==(n=a.itemsPerRequest)&&void 0!==n?n:0,e.next=6,c.Products.With("main_images").Limit(s).Sort("created_at").All();case 6:if(i=e.sent,u=B(i,null!==(r=a.selectedValue)&&void 0!==r?r:"sku"),!(t.length>0)){e.next=10;break}return e.abrupt("return",u.filter((function(e){return t.includes(e.connectorValue)})));case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,a){return J.apply(this,arguments)}function J(){return(J=Object(u.a)(o.a.mark((function e(t,a,n){var r,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.Products.With("main_images").Filter({eq:Object(l.a)({},a.selectedValue,t)}).All();case 3:if(c=e.sent,0!==(s=B(c,null!==(r=a.selectedValue)&&void 0!==r?r:"sku")).length){e.next=7;break}return e.abrupt("return",be(t));case 7:return e.abrupt("return",s[0]);case 10:return e.prev=10,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",be(t));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function Y(e,t,a,n){return Q.apply(this,arguments)}function Q(){return(Q=Object(u.a)(o.a.mark((function e(t,a,n,r){var c,s,i,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(r);case 2:return i=e.sent,l=null!==(c=r.itemsPerRequest)&&void 0!==c?c:0,e.next=6,i.Products.With("main_images").Filter(Object(p.a)({},z(0,t,a,n))).Limit(l).Sort("created_at").All();case 6:return u=e.sent,e.abrupt("return",B(u,null!==(s=r.selectedValue)&&void 0!==s?s:"sku"));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,a,n){return Z.apply(this,arguments)}function Z(){return(Z=Object(u.a)(o.a.mark((function e(t,a,n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,a,n,r));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(u.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(t);case 2:return a=e.sent,e.next=5,a.Categories.Sort("created_at").All();case 5:return n=e.sent,e.abrupt("return",n.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ae.apply(this,arguments)}function ae(){return(ae=Object(u.a)(o.a.mark((function e(t){var a,n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(t);case 2:return a=e.sent,e.next=5,a.Collections.Sort("created_at").All();case 5:return n=e.sent,e.abrupt("return",n.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ne=a(40),re=a.n(ne),ce=a(81),se=a.n(ce);function ie(e,t,a){return oe.apply(this,arguments)}function oe(){return(oe=Object(u.a)(o.a.mark((function e(t,a,n){var r,c,s,i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null!==(r=a.selectedValue)&&void 0!==r?r:"sku",e.prev=1,s="id"===c?"/pcm/catalog/products/".concat(t):"/pcm/catalog/products?filter=eq(sku,".concat(t,")"),e.next=5,n.get(s);case 5:if(200===(i=e.sent).status){e.next=8;break}return e.abrupt("return",be(t));case 8:return u=Array.isArray(i.data.data)?i.data.data[0]:i.data.data,e.abrupt("return",he(u,c));case 12:return e.prev=12,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",be(t));case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function ue(e,t){return le.apply(this,arguments)}function le(){return(le=Object(u.a)(o.a.mark((function e(t,a){var n,r,c,s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(a);case 2:return r=e.sent,e.next=5,pe(r);case 5:if(c=e.sent,s=null!==(n=a.selectedValue)&&void 0!==n?n:"sku",i=c.map((function(e){return he(e,s)})),!(t.length>0)){e.next=10;break}return e.abrupt("return",i.filter((function(e){return t.includes(e.connectorValue)})));case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e){return de.apply(this,arguments)}function de(){return(de=Object(u.a)(o.a.mark((function e(t){var a,n,r,c,s,i,u,l,p,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=25,0,r=0,c=[],s=[],i=new se.a({minTime:300,maxConcurrent:20}),e.next=8,t.Catalog.Products.Limit(n).Offset(0).All();case 8:if(u=e.sent,(a=s).push.apply(a,Object(x.a)(null===u||void 0===u?void 0:u.data)),r=u.meta.results.total,!(n<=r)){e.next=18;break}for(l=function(e){c.push(i.schedule((function(){return t.Catalog.Products.Limit(n).Offset(e).All()})))},p=n;p<r;p+=n)l(p);return e.next=16,Promise.all(c);case 16:d=e.sent,s=s.concat(d.map((function(e){return e.data})).flat(1));case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var he=function(e,t){var a,n,r,c=re.a.get(e,"relationships.main_image.data.link.href");return{id:e.id,name:e.attributes.name,connectorValue:"sku"===t?e.attributes.sku:e.id,image:c,imageFileId:null===e||void 0===e||null===(a=e.relationships)||void 0===a||null===(n=a.main_image)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.id,sku:e.attributes.sku}},fe=function(){var e=Object(u.a)(o.a.mark((function e(t,a,n){var r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",W(t,a,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return r=e.sent,c=r.filter((function(e){return e})),e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),me=function(){var e=Object(u.a)(o.a.mark((function e(t,a,n){var r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ie(t,a,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return r=e.sent,c=r.filter((function(e){return e})),e.abrupt("return",c);case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),be=function(e){var t="[Not Found] ".concat(e);return{connectorValue:e,image:"",id:t,name:t,sku:t}},je=function(e){var t=e.connectorValues,a=e.className,r=e.setConnectorValues,c=Object(n.useContext)(ve),s=c.sdk,i=c.config,l=c.axiosClient,p=c.moltin,d=Object(n.useState)([]),h=Object(O.a)(d,2),f=h[0],m=h[1],b=Object(n.useState)(!0),j=Object(O.a)(b,2),v=j[0],y=j[1];Object(n.useEffect)((function(){p&&l&&("pcm"===i.productType?function(){var e=Object(u.a)(o.a.mark((function e(){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me(t,i,l);case 2:a=e.sent,m(a),y(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}():function(){var e=Object(u.a)(o.a.mark((function e(){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe(t,i,p);case 2:a=e.sent,m(a),y(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())()}),[t,p,l,i]);return 0===f.length||v?null:Object(g.jsx)("div",{className:a,children:Object(g.jsx)(L,{onSortStart:function(e,t){return t.preventDefault()},onSortEnd:function(e){var a=e.oldIndex,n=e.newIndex,c=k()(t,a,n);s.field.setValue(c),r(c),y(!0)},axis:"xy",deleteFn:function(e){var a=Object(x.a)(t);a.splice(e,1),a.length>0?s.field.setValue(a):s.field.removeValue(),y(!0),r(a)},productPreviews:f,useDragHandle:!0})})},ge=a.p+"static/media/logo.0789f3c0.svg",ve=r.a.createContext({}),Oe=function(){var e=Object(n.useContext)(ve).sdk,t=Object(n.useState)(function(e){var t=e.field.getValue();return(Array.isArray(t)?t:[t]).filter((function(e){return e}))}(e)),a=Object(O.a)(t,2),r=a[0],c=a[1],s=r.length;return Object(n.useEffect)((function(){e.window.updateHeight(90*(s+1))}),[s,e.window]),Object(g.jsxs)("div",{className:"ep-product-preview-wrapper",children:[r.length>0&&Object(g.jsx)(je,{connectorValues:r,className:"ep-product-preview",setConnectorValues:c}),Object(g.jsxs)("div",{className:"ep-connector-container",children:[Object(g.jsx)("img",{src:ge,alt:"Logo",className:"ep-logo"}),Object(g.jsx)(b.a,{icon:"ShoppingCart",buttonType:"muted",size:"small",onClick:function(){return S(e,c)},children:"Array"!==e.field.type?"Select product":"Select products"})]})]})},xe=function(e){var t=e.sdk,a=t.parameters.installation,r=Object(n.useState)({moltin:null,axiosClient:null}),c=Object(O.a)(r,2),s=c[0],i=c[1];Object(n.useEffect)((function(){(function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,r,c,u,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!s.axiosClient||!s.moltin){e.next=3;break}return e.abrupt("return");case 3:return t=F(a),n=D(a),e.next=7,Promise.all([t,n]);case 7:r=e.sent,c=Object(O.a)(r,2),u=c[0],l=c[1],i({moltin:u,axiosClient:l}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}})()()}),[a,s.axiosClient,s.moltin]);var l=s.axiosClient,p=s.moltin;return p&&l?Object(g.jsx)(ve.Provider,{value:{sdk:t,moltin:p,config:a,axiosClient:l},children:Object(g.jsx)(Oe,{})}):null},ye=a(83),ke=a(82),Pe=a.n(ke),Ce=function(e){var t=e.onSelectProduct,a=e.product,n=e.selectedProducts,r=e.moltin,c=n.includes(a.connectorValue),s=N(r,a).imageUrl,i=a.name||a.sku;return Object(g.jsx)("div",{className:"ep-product-wrapper",children:Object(g.jsxs)("div",{"data-test-id":"product-preview-".concat(a.connectorValue),role:"switch","aria-checked":c,tabIndex:-1,className:"ep-product ".concat(c?"ep-selected-product":""),onKeyUp:Pe.a,onClick:function(){return e=a.connectorValue,void(t&&t(e));var e},children:[Object(g.jsx)("div",{className:"ep-product-image-wrapper",children:Object(g.jsx)("img",{style:{display:"block"},src:w(s),alt:"product preview",className:"ep-product-image-preview","data-test-id":"image"})}),Object(g.jsx)("p",{className:"ep-product-name",children:i}),Object(g.jsx)("p",{className:"ep-product-connectorValue",children:a.connectorValue})]})})},we=(a(77),-888),Se=function(e,t){var a=t-e+1;return Array.from({length:a},(function(t,a){return a+e}))},Te=function(e){var t=e.allProductsList,a=e.sdk,r=Object(n.useState)(!1),c=Object(O.a)(r,2),s=c[0],i=c[1],l=Object(n.useState)(t),p=Object(O.a)(l,2),d=p[0],h=p[1],f=Object(n.useState)(""),m=Object(O.a)(f,2),j=m[0],v=m[1],y=Object(n.useState)(1),k=Object(O.a)(y,2),P=k[0],C=k[1],w=Object(n.useState)([]),S=Object(O.a)(w,2),T=S[0],N=S[1],V=Object(n.useState)(),I=Object(O.a)(V,2),L=I[0],A=I[1],M=Object(n.useMemo)((function(){return new ye.a(t,{keys:["name","sku"],minMatchCharLength:1,threshold:.4})}),[t]);Object(n.useEffect)((function(){var e="Array",t=[],n=a.parameters.invocation;e=n.fieldType,t=n.fieldValue,N(t),i("Array"===e),function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(a.parameters.installation);case 2:t=e.sent,A(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[a]),Object(n.useEffect)((function(){var e=j?M.search(j).map((function(e){return e.item})):t;h(e)}),[j,t,M]);var R=Object(n.useMemo)((function(){return Object(ne.debounce)((function(e){v(e),C(1)}),300)}),[]),E=function(e){var t=e.totalCount,a=e.pageSize,r=e.siblingCount,c=void 0===r?1:r,s=e.currentPage;return Object(n.useMemo)((function(){var e=Math.ceil(t/a);if(e<=c+5)return Se(1,e);var n=Math.max(s-c,1),r=Math.min(s+c,e),i=n>2,o=r<e-2,u=1,l=e;if(!i&&o){var p=Se(1,3+2*c);return[].concat(Object(x.a)(p),[-999,e])}if(i&&!o){var d=Se(e-(3+2*c)+1,e);return[u,we].concat(Object(x.a)(d))}if(i&&o){var h=Se(n,r);return[u,we].concat(Object(x.a)(h),[-999,l])}return[]}),[t,a,c,s])}({currentPage:P,pageSize:24,totalCount:d.length,siblingCount:1}),_=function(e){C(e)},q=function(e){return s?(t=T.includes(e)?Object(x.a)(T).filter((function(t){return t!==e})):[].concat(Object(x.a)(T),[e]),N(t)):T[0]===e?N([]):N([e]);var t},D=E[E.length-1],B=d.slice(24*(P-1),24*P);return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("header",{className:"ep-gallery-header",children:[Object(g.jsxs)("div",{className:"ep-gallery-controls",children:[Object(g.jsx)(b.o,{placeholder:"Search by SKU...",type:"search",name:"connectorValue-search",id:"connectorValue-search",testId:"connectorValue-search",value:"",width:"medium",className:"ep-gallery-search-box",onInput:function(e){return R(e.target.value)}}),Object(g.jsx)(b.g,{color:"muted",icon:"Search",className:"ep-gallery-search-icon"})]}),Object(g.jsx)(g.Fragment,{children:Object(g.jsxs)("div",{className:"ep-gallery-controls-right",children:[Object(g.jsx)(b.a,{className:"control",buttonType:"primary",onClick:function(){a.close([])},children:"Clear"}),Object(g.jsx)(b.a,{className:"control",buttonType:"primary",onClick:function(){a.close(T)},disabled:0===T.length,children:s?function(){var e=T.length;switch(e){case 0:return"Save (No products Selected)";case 1:return"Save 1 product";default:return"Save ".concat(e," products")}}():"Save"})]})})]}),Object(g.jsxs)("section",{children:[Object(g.jsx)("div",{className:"ep-gallery-list",children:d.length>0&&B.map((function(e,t){return Object(g.jsx)(Ce,{product:e,selectedProducts:T,onSelectProduct:q,sdk:a,moltin:L},t)}))}),Object(g.jsx)("nav",{"aria-label":"Pages",children:Object(g.jsxs)("ul",{className:"ep-pagination",children:[Object(g.jsx)("li",{className:"page-item",children:Object(g.jsx)(b.a,{buttonType:"muted",size:"small",onClick:function(){return _(P>1?P-1:P)},children:"<"})}),E.map((function(e){return-888===e||-999===e?Object(g.jsx)("li",{className:"page-item",children:"..."},e):Object(g.jsx)("li",{className:"page-item".concat(P===e?" active":""),children:Object(g.jsx)(b.a,{buttonType:P===e?"primary":"muted",size:"small",onClick:function(){return _(e)},children:e})},e)})),Object(g.jsx)("li",{className:"page-item",children:Object(g.jsx)(b.a,{buttonType:"muted",size:"small",onClick:function(){return _(P<D?P+1:P)},children:">"})})]})})]})]})},Ne=a(37),Ve="LEFT",Ie="RIGHT",Le=function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e,r=[];n<=t;)r.push(n),n+=a;return r},Ae=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).pageLimit=void 0,n.totalRecords=void 0,n.pageNeighbours=void 0,n.totalPages=void 0,n.fetchPageNumbers=function(){var e=n.totalPages,t=n.state.currentPage,a=n.pageNeighbours,r=2*n.pageNeighbours+3;if(e>r+2){var c=Math.max(2,t-a),s=Math.min(e-1,t+a),i=Le(c,s),o=c>2,u=e-s>1,l=r-(i.length+1);switch(!0){case o&&!u:var p=Le(c-l,c-1);i=[Ve].concat(Object(x.a)(p),Object(x.a)(i));break;case!o&&u:var d=Le(s+1,s+l);i=[].concat(Object(x.a)(i),Object(x.a)(d),[Ie]);break;case o&&u:default:i=[Ve].concat(Object(x.a)(i),[Ie])}return[1].concat(Object(x.a)(i),[e])}return Le(1,e)},n.gotoPage=function(e){var t=n.props.onPageChanged,a=void 0===t?function(e){return e}:t,r=Math.max(0,Math.min(e,n.totalPages)),c={currentPage:r,totalPages:n.totalPages,pageLimit:n.pageLimit,totalRecords:n.totalRecords};n.setState({currentPage:r},(function(){return a(c,Object(Ne.a)(n))}))},n.handleClick=function(e){return function(t){t.preventDefault(),n.gotoPage(e)}},n.handleMoveLeft=function(e){e.preventDefault(),n.gotoPage(n.state.currentPage-2*n.pageNeighbours-1)},n.handleMoveRight=function(e){e.preventDefault(),n.gotoPage(n.state.currentPage+2*n.pageNeighbours+1)},n.pageLimit=0,n.totalRecords=0,n.pageNeighbours=0,n.totalPages=0,n.calculatePages(),n.state={currentPage:1},n}return Object(h.a)(a,[{key:"calculatePages",value:function(){var e=this.props,t=e.totalRecords,a=void 0===t?null:t,n=e.pageLimit,r=void 0===n?30:n,c=e.pageNeighbours,s=void 0===c?0:c;this.pageLimit=r||30,this.totalRecords=a||0,this.pageNeighbours=s?Math.max(0,Math.min(s,2)):0,this.totalPages=Math.ceil(this.totalRecords/this.pageLimit)}},{key:"componentDidMount",value:function(){this.gotoPage(1)}},{key:"render",value:function(){var e=this;if(this.calculatePages(),!this.totalRecords||1===this.totalPages)return null;var t=this.state.currentPage,a=this.fetchPageNumbers();return Object(g.jsx)("nav",{"aria-label":"Countries Pagination",children:Object(g.jsx)("ul",{className:"ep-pagination",children:a.map((function(a,n){return a===Ve?Object(g.jsx)("li",{className:"page-item",children:Object(g.jsxs)(b.a,{buttonType:"muted","aria-label":"Previous",onClick:e.handleMoveLeft,children:[Object(g.jsx)("span",{"aria-hidden":"true",children:"\xab"}),Object(g.jsx)("span",{className:"sr-only",children:"Previous"})]})},n):a===Ie?Object(g.jsx)("li",{className:"page-item",children:Object(g.jsxs)(b.a,{buttonType:"muted","aria-label":"Next",onClick:e.handleMoveRight,children:[Object(g.jsx)("span",{"aria-hidden":"true",children:"\xbb"}),Object(g.jsx)("span",{className:"sr-only",children:"Next"})]})},n):Object(g.jsx)("li",{className:"page-item".concat(t===a?" active":""),children:Object(g.jsx)(b.a,{buttonType:t===a?"primary":"muted",size:"small",onClick:e.handleClick(a),children:a})},n)}))})})}}]),a}(n.Component),Me=24,Re=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).allowMultipleSelection=!1,e.searchTimout=void 0,e.state={productList:[],searchTerm:"",searchCategoryId:"",searchCollectionId:"",searchCategories:[],searchCollections:[],offsetItems:0,currentPage:1,loading:!0,paginationObject:{},selectedProducts:[],moltin:null},e}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e,t,a=this,n=[],r=this.props.sdk.parameters.invocation;t=r.fieldType,n=r.fieldValue,this.setState({selectedProducts:n}),this.allowMultipleSelection="Array"===t;var c=this.props.sdk.parameters.installation;Me=c.itemsPerPage?parseInt(c.itemsPerPage):24,this.performSearch(),this.populateSelects();var s=Object(M.gateway)({client_id:this.props.sdk.parameters.installation.clientId,host:null===(e=this.props.sdk.parameters.installation.host)||void 0===e?void 0:e.replace("https://","")});s.Authenticate().then((function(){a.setState({moltin:s})}))}},{key:"populateSelects",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(this.props.sdk.parameters.installation);case 2:return t=e.sent,e.next=5,te(this.props.sdk.parameters.installation);case 5:a=e.sent,this.setState({searchCategories:t,searchCollections:a});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSearchByTerm",value:function(e){var t=this;this.searchTimout&&clearTimeout(this.searchTimout),this.searchTimout=setTimeout((function(){t.setState({searchTerm:e},t.performSearch)}),300)}},{key:"performSearch",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(this.state.searchTerm,this.state.searchCategoryId,this.state.searchCollectionId,this.props.sdk.parameters.installation);case 2:t=e.sent,0!==this.state.currentPage&&this.state.paginationObject instanceof Ae&&this.state.paginationObject.gotoPage(1),this.setState({productList:t,loading:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSearchByCategory",value:function(e){var t=e.currentTarget.value;this.setState({searchCategoryId:t},this.performSearch)}},{key:"onSearchByCollection",value:function(e){var t=e.currentTarget.value;this.setState({searchCollectionId:t},this.performSearch)}},{key:"onPageChanged",value:function(e,t){var a,n=((null!==(a=e.currentPage)&&void 0!==a?a:0)-1)*Me,r=e.currentPage*Me;this.setState({offsetItems:n,currentPage:r,paginationObject:t})}},{key:"onSelectProduct",value:function(e){var t;t=this.allowMultipleSelection?this.state.selectedProducts.includes(e)?this.state.selectedProducts.filter((function(t){return t!==e})):[].concat(Object(x.a)(this.state.selectedProducts),[e]):[e],this.setState({selectedProducts:t})}},{key:"saveSelected",value:function(){this.props.sdk.close(this.state.selectedProducts)}},{key:"isLastPageSelected",value:function(){var e=this.state.productList.length-this.state.offsetItems;return e<Me&&e===this.state.selectedProducts.length}},{key:"selectAll",value:function(){if(this.allowMultipleSelection&&this.state.selectedProducts.length<Me){var e,t=Me+this.state.offsetItems,a=this.state.productList.slice(this.state.offsetItems,t),n=[],r=Object(A.a)(a);try{for(r.s();!(e=r.n()).done;){var c=e.value;n.push(c.connectorValue)}}catch(s){r.e(s)}finally{r.f()}this.setState({selectedProducts:n})}(this.state.selectedProducts.length===Me||this.isLastPageSelected())&&this.selectNone()}},{key:"selectNone",value:function(){this.setState({selectedProducts:[]})}},{key:"saveButtonLabel",value:function(){var e=this.state.selectedProducts.length;switch(e){case 0:return"Save products";case 1:return"Save 1 product";default:return"Save ".concat(e," products")}}},{key:"selectAllButtonLabel",value:function(){return this.state.selectedProducts.length===Me||this.isLastPageSelected()?"Select None":"Select All"}},{key:"render",value:function(){var e=this;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("header",{className:"ep-gallery-header",children:["product"===this.props.sdk.parameters.installation.productType&&Object(g.jsxs)("div",{className:"ep-gallery-controls",children:[Object(g.jsx)(b.o,{placeholder:"Search by SKU",type:"search",name:"connectorValue-search",id:"connectorValue-search",testId:"connectorValue-search",value:"",width:"medium",className:"ep-gallery-search-box",onKeyUp:function(t){return e.onSearchByTerm(t.target.value)}}),Object(g.jsx)(b.g,{color:"muted",icon:"Search",className:"ep-gallery-search-icon"}),Object(g.jsxs)(b.k,{value:this.state.searchCategoryId,onChange:this.onSearchByCategory.bind(this),children:[Object(g.jsx)(b.i,{value:"",children:"Select a category"}),this.state.searchCategories.length>0&&this.state.searchCategories.map((function(e,t){return Object(g.jsx)(b.i,{value:e.id,children:e.name},t)}))]}),Object(g.jsxs)(b.k,{value:this.state.searchCollectionId,onChange:this.onSearchByCollection.bind(this),children:[Object(g.jsx)(b.i,{value:"",children:"Select a collection"}),this.state.searchCollections.length>0&&this.state.searchCollections.map((function(e,t){return Object(g.jsx)(b.i,{value:e.id,children:e.name},t)}))]})]}),"pcm"===this.props.sdk.parameters.installation.productType&&Object(g.jsxs)("div",{className:"ep-gallery-controls",children:[Object(g.jsx)(b.o,{placeholder:"Enter exact SKU ...",type:"search",name:"connectorValue-search",id:"connectorValue-search",testId:"connectorValue-search",value:"",width:"medium",className:"ep-gallery-search-box",onKeyUp:function(t){return e.onSearchByTerm(t.target.value)}}),Object(g.jsx)(b.g,{color:"muted",icon:"Search",className:"ep-gallery-search-icon"})]}),Object(g.jsx)(g.Fragment,{children:Object(g.jsxs)("div",{className:"ep-gallery-controls-right",children:[this.allowMultipleSelection&&Object(g.jsx)(b.a,{buttonType:"primary",onClick:this.selectAll.bind(this),children:this.selectAllButtonLabel()}),Object(g.jsx)("span",{children:"\xa0"}),Object(g.jsx)(b.a,{buttonType:"primary",onClick:this.saveSelected.bind(this),children:this.allowMultipleSelection?this.saveButtonLabel():"Save"})]})})]}),Object(g.jsxs)("section",{children:[Object(g.jsxs)("div",{className:"ep-gallery-list",children:[this.state.productList.length>0&&!this.state.loading&&this.state.productList.slice(this.state.offsetItems,this.state.currentPage).map((function(t,a){return Object(g.jsx)(Ce,{product:t,selectedProducts:e.state.selectedProducts,onSelectProduct:function(t){return e.onSelectProduct(t)},sdk:e.props.sdk,moltin:e.state.moltin},a)})),this.state.loading&&Object(g.jsx)(b.d,{headingProps:{text:"Loading..."},descriptionProps:{text:"Please wait while the product list loads."}}),!this.state.loading&&this.state.productList.length<1&&Object(g.jsx)(b.d,{headingProps:{text:"No product found..."},descriptionProps:{text:"Please try searching again using different terms."}})]}),this.state.productList.length>0&&Object(g.jsx)(Ae,{totalRecords:this.state.productList.length,pageLimit:Me,pageNeighbours:2,onPageChanged:this.onPageChanged.bind(this)})]})]})}}]),a}(n.Component),Ee=function(e){Object(f.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={productList:[],config:e.props.sdk.parameters.installation},e.integrationType=e.props.sdk.parameters.installation.productType,e}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.fetchProducts()}},{key:"getLegacyProducts",value:function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K([],this.props.sdk.parameters.installation);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPCMProducts",value:function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue([],this.props.sdk.parameters.installation);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchProducts",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.sdk.parameters.installation,"product"!==t.productType){e.next=8;break}return e.next=5,this.getLegacyProducts();case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,this.getPCMProducts();case 10:e.t0=e.sent;case 11:a=e.t0,this.setState((function(){return{productList:a}}));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return"product"===this.state.config.productType?Object(g.jsx)(Re,{productList:this.state.productList,sdk:this.props.sdk}):Object(g.jsx)(Te,{allProductsList:this.state.productList,sdk:this.props.sdk})}}]),a}(n.Component);Object(s.init)((function(e){var t=document.getElementById("root");[{location:s.locations.LOCATION_APP_CONFIG,component:Object(g.jsx)(v,{sdk:e})},{location:s.locations.LOCATION_ENTRY_FIELD,component:Object(g.jsx)(xe,{sdk:e})},{location:s.locations.LOCATION_DIALOG,component:Object(g.jsx)(Ee,{sdk:e})}].forEach((function(a){e.location.is(a.location)&&Object(c.render)(a.component,t)}))}))},77:function(e,t,a){},91:function(e,t,a){}},[[184,1,2]]]);