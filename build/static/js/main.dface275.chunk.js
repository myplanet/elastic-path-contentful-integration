(this.webpackJsonpepconnector=this.webpackJsonpepconnector||[]).push([[0],{104:function(e,t,a){},120:function(e,t){},122:function(e,t){},247:function(e,t,a){},248:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a(16),c=a(33),s=(a(102),a(103),a(104),a(2)),i=a.n(s),o=a(5),l=a(23),u=a(9),p=a(7),d=a(8),h=a(11),m=a(10),f=a(3),g=a(97),j=a(1),b=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).onParameterChange=function(e,t){var a=t.currentTarget.value;n.setState((function(t){return{parameters:Object(u.a)(Object(u.a)({},t.parameters),{},Object(l.a)({},e,a))}}))},n.onConfigure=Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.sdk.app.getCurrentState();case 2:return t=e.sent,e.abrupt("return",{parameters:n.state.parameters,targetState:t});case 4:case"end":return e.stop()}}),e)}))),n.state={parameters:{storeId:"",clientId:"",host:"api.moltin.com",productType:"product",selectedValue:"sku",itemsPerRequest:100,itemsPerPage:24,pcmChannel:"",pcmTag:""}},e.sdk.app.onConfigure((function(){return n.onConfigure()})),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.sdk.app.getParameters();case 2:t=e.sent,this.setState(t?{parameters:t}:this.state,(function(){a.props.sdk.app.setReady()}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(j.jsx)(f.q,{className:Object(g.a)({margin:"80px"}),children:Object(j.jsxs)(f.e,{children:[Object(j.jsx)(f.f,{children:"App Config"}),Object(j.jsx)(f.j,{children:"Enter your Elastic Path configuration in order to fetch products to be linked on your content."}),Object(j.jsx)(f.n,{required:!0,name:"clientId",id:"clientId",value:this.state.parameters.clientId||"",onChange:this.onParameterChange.bind(this,"clientId"),labelText:"Elastic Path Client ID",helpText:"Copy your Elastic Path Client ID and enter it here."}),Object(j.jsx)(f.n,{required:!0,name:"host",id:"host",value:this.state.parameters.host||"api.moltin.com",onChange:this.onParameterChange.bind(this,"host"),labelText:"Elastic Path host url",helpText:"Copy your Elastic Path host url and enter it here."}),Object(j.jsxs)(f.l,{required:!0,id:"productType",name:"productType",labelText:"Products Type",onChange:this.onParameterChange.bind(this,"productType"),helpText:"Select the ElasticPath Product catalog to pull from, legacy or pcm.",value:this.state.parameters.productType||"product",children:[Object(j.jsx)(f.i,{value:"product",children:"product (legacy)"}),Object(j.jsx)(f.i,{value:"pcm",children:"pcm"})]}),"pcm"===this.state.parameters.productType&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(f.n,{name:"pcmChannel",id:"pcmChannel",value:this.state.parameters.pcmChannel||"",onChange:this.onParameterChange.bind(this,"pcmChannel"),labelText:"PCM Catalog Rule Channel",helpText:"Set the channel to specify what PCM catalog to query from. See your Catalog Rules for configued channels. Create a channel if none exist on your desired catalog."}),Object(j.jsx)(f.n,{name:"pcmTag",id:"pcmTag",value:this.state.parameters.pcmTag||"",onChange:this.onParameterChange.bind(this,"pcmTag"),labelText:"PCM Catalog Rule Tag ",helpText:"Set the tag to specify which PCM catalog to query from. See your Catalog Rules for configued tags. Create a tag if none exist on your desired catalog."})]}),Object(j.jsxs)(f.l,{required:!0,id:"selectedValue",name:"selectedValue",labelText:"connector Value Type",onChange:this.onParameterChange.bind(this,"selectedValue"),helpText:"Choose whether Contentful stores the product Id, or SKU, of products selected through this integration.",value:this.state.parameters.selectedValue||"sku",children:[Object(j.jsx)(f.i,{value:"sku",children:"sku"}),Object(j.jsx)(f.i,{value:"id",children:"id"})]}),Object(j.jsx)(f.n,{required:!0,name:"itemsPerRequest",id:"itemsPerRequest",value:this.state.parameters.itemsPerRequest?this.state.parameters.itemsPerRequest.toString():"".concat(100),onChange:this.onParameterChange.bind(this,"itemsPerRequest"),labelText:"Items fetched per request (legacy catalog integration only)",helpText:"Number of products fetched from Elastic Path during product fetching."}),Object(j.jsx)(f.n,{required:!0,name:"itemsPerPage",id:"itemsPerPage",value:this.state.parameters.itemsPerPage?this.state.parameters.itemsPerPage.toString():"".concat(24),onChange:this.onParameterChange.bind(this,"itemsPerPage"),labelText:"Products per page",helpText:"Number of items displayed on product selection page."})]})})}}]),a}(n.Component),v=a(46),O=a(47),x=function(){var e=Object(o.a)(i.a.mark((function e(t){var a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="pcm"===t.productType?Object(u.a)(Object(u.a)({},t.pcmChannel?{"EP-Channel":t.pcmChannel}:{}),t.pcmTag?{"EP-Context-Tag":t.pcmTag}:{}):{},r=Object(O.gateway)({client_id:t.clientId,host:null===(a=t.host)||void 0===a?void 0:a.replace("https://",""),headers:n}),e.next=4,r.Authenticate();case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function y(e,t){var a,n=[],r=Object(v.a)(e.data);try{for(r.s();!(a=r.n()).done;){var c,s,i,o,l=a.value,u={id:l.id,name:l.name,connectorValue:"sku"===t?l.sku:l.id,imageFileId:null===l||void 0===l||null===(c=l.relationships)||void 0===c||null===(s=c.main_image)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.id,image:e.included?P(l,null===(o=e.included)||void 0===o?void 0:o.main_images):null,sku:l.sku};n.push(u)}}catch(p){r.e(p)}finally{r.f()}return n}function P(e,t){var a=t.find((function(t){var a,n,r,c,s=(null===(a=e.relationships)||void 0===a?void 0:a.main_image)?null===(n=e.relationships)||void 0===n||null===(r=n.main_image)||void 0===r||null===(c=r.data)||void 0===c?void 0:c.id:null;return t.id===s}));return a?a.link.href:""}function k(e,t,a,n){var r={},c={};if(t&&""!==t){var s=t.replace(/[^\w\-\s]+/i,"");s=encodeURI("*".concat(t,"*")),r=Object(u.a)(Object(u.a)({},r),{},{like:{sku:s}})}return a&&""!==a&&(c=Object(u.a)(Object(u.a)({},c),{},{category:{id:a}})),n&&""!==n&&(c=Object(u.a)(Object(u.a)({},c),{},{collection:{id:n}})),r=Object(u.a)(Object(u.a)({},r),{},{eq:Object(u.a)({},c)})}var C=function(){var e=Object(o.a)(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S(t,a));case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function S(e,t){return w.apply(this,arguments)}function w(){return(w=Object(o.a)(i.a.mark((function e(t,a){var n,r,c,s,o,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(a);case 2:return c=e.sent,s=null!==(n=a.itemsPerRequest)&&void 0!==n?n:0,e.next=6,c.Products.With("main_images").Limit(s).Sort("created_at").All();case 6:if(o=e.sent,l=y(o,null!==(r=a.selectedValue)&&void 0!==r?r:"sku"),!(t.length>0)){e.next=10;break}return e.abrupt("return",l.filter((function(e){return t.includes(e.connectorValue)})));case 10:return e.abrupt("return",l);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,a,n){return N.apply(this,arguments)}function N(){return(N=Object(o.a)(i.a.mark((function e(t,a,n,r){var c,s,o,l,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(r);case 2:return o=e.sent,p=null!==(c=r.itemsPerRequest)&&void 0!==c?c:0,e.next=6,o.Products.With("main_images").Filter(Object(u.a)({},k(0,t,a,n))).Limit(p).Sort("created_at").All();case 6:return l=e.sent,e.abrupt("return",y(l,null!==(s=r.selectedValue)&&void 0!==s?s:"sku"));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t,a,n){return I.apply(this,arguments)}function I(){return(I=Object(o.a)(i.a.mark((function e(t,a,n,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",T(t,a,n,r));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return M.apply(this,arguments)}function M(){return(M=Object(o.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t);case 2:return a=e.sent,e.next=5,a.Categories.Sort("created_at").All();case 5:return n=e.sent,e.abrupt("return",n.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return R.apply(this,arguments)}function R(){return(R=Object(o.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t);case 2:return a=e.sent,e.next=5,a.Collections.Sort("created_at").All();case 5:return n=e.sent,e.abrupt("return",n.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=a(6),D=a(48),q=a.n(D),_=a(91),F=a.n(_);function U(e,t){return B.apply(this,arguments)}function B(){return(B=Object(o.a)(i.a.mark((function e(t,a){var n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(a);case 2:return n=e.sent,e.next=5,H(n);case 5:if(r=e.sent,c=r.map((function(e){var t,n,r,c=q.a.get(e,"relationships.main_image.data.link.href");return{id:e.id,name:e.attributes.name,connectorValue:"sku"===a.selectedValue?e.attributes.sku:e.id,image:c,imageFileId:null===e||void 0===e||null===(t=e.relationships)||void 0===t||null===(n=t.main_image)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.id,sku:e.attributes.sku}})),!(t.length>0)){e.next=9;break}return e.abrupt("return",c.filter((function(e){return t.includes(e.connectorValue)})));case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return K.apply(this,arguments)}function K(){return(K=Object(o.a)(i.a.mark((function e(t){var a,n,r,c,s,o,l,u,p,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=25,0,r=0,c=[],s=[],o=new F.a({minTime:300,maxConcurrent:20}),e.next=8,t.Catalog.Products.Limit(n).Offset(0).All();case 8:if(l=e.sent,(a=s).push.apply(a,Object(E.a)(null===l||void 0===l?void 0:l.data)),r=l.meta.results.total,!(n<=r)){e.next=18;break}for(u=function(e){c.push(o.schedule((function(){return t.Catalog.Products.Limit(n).Offset(e).All()})))},p=n;p<r;p+=n)u(p);return e.next=16,Promise.all(c);case 16:d=e.sent,s=s.concat(d.map((function(e){return e.data})).flat(1));case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=a(92),G=a.n(z),J=a.p+"static/media/image-placeholder.a504e5da.svg",W=function(e,t,a){return e.slice().sort((function(e,n){var r=e[a],c=n[a];return t.indexOf(r)>t.indexOf(c)?1:-1}))},Y=function(e){return e&&""!==e?e:J},Q=a(93),X=a.n(Q),Z=a(94),$=a.n(Z),ee=a(32),te=a(18),ae=function(e,t){var a=Object(n.useState)(""),r=Object(te.a)(a,2),c=r[0],s=r[1];return Object(n.useEffect)((function(){e&&!t.image&&t.imageFileId&&function(){var a=Object(o.a)(i.a.mark((function a(){return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.Files.Get(t.imageFileId).then((function(e){s(e.data.link.href)}));case 1:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}()()}),[e,t]),{imageUrl:t.image||c}},ne=Object(ee.c)((function(){return Object(j.jsx)(f.c,{className:"ep-card-handler",children:"Reorder product"})})),re=Object(ee.b)((function(e){var t=e.product,a=e.isSortable,n=e.onDelete,r=e.moltin,c=ae(r,t).imageUrl;return Object(j.jsxs)(f.b,{className:"ep-preview-wrapper",children:[a&&Object(j.jsx)(ne,{}),Object(j.jsx)("div",{className:"ep-preview-image-wrapper",children:Object(j.jsx)("img",{className:"ep-preview-image",src:Y(c),alt:t.name})}),Object(j.jsx)("section",{className:"ep-preview-section",children:Object(j.jsxs)(f.p,{children:[Object(j.jsx)(f.f,{className:"ep-preview-name",children:t.name}),Object(j.jsx)(f.m,{className:"ep-preview-connectorValue",children:t.connectorValue})]})}),Object(j.jsx)("div",{className:"ep-product-item-actions",children:Object(j.jsx)(f.h,{label:"Delete",iconProps:{icon:"Close"},buttonType:"muted",onClick:n})})]},"".concat(t.id,"-").concat(t.connectorValue))})),ce=Object(ee.a)((function(e){var t=e.deleteFn,a=e.productPreviews,n=e.moltin,r=a.length>1;return Object(j.jsx)("div",{children:a.map((function(e,a){return Object(j.jsx)(re,{moltin:n,product:e,onDelete:function(){return t(a)},isSortable:r,index:a},"".concat(e.id,"-").concat(e.connectorValue))}))})})),se=(a(247),function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={productPreviews:[],moltin:null},e.updateProductPreviews=Object(o.a)(i.a.mark((function t(){var a,n,r,c,s,o,l,u=arguments;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=!(u.length>0&&void 0!==u[0])||u[0],t.prev=1,n=e.props,r=n.fetchProductPreviews,c=n.connectorValues,!a){t.next=9;break}return t.next=6,r(c);case 6:t.t0=t.sent,t.next=10;break;case 9:t.t0=e.state.productPreviews;case 10:s=t.t0,o=W(s,c,"connectorValue"),l=o.map((function(e){return e.connectorValue})),e.props.onChange(l),e.setState({productPreviews:o}),t.next=21;break;case 17:t.prev=17,t.t1=t.catch(1),e.props.sdk.notifier.error("There was an error fetching the data for the selected products."),console.log("updateProductPreviews",t.t1);case 21:case"end":return t.stop()}}),t,null,[[1,17]])}))),e.onSortEnd=function(t){var a=t.oldIndex,n=t.newIndex,r=G()(e.props.connectorValues,a,n);e.props.onChange(r)},e.deleteItem=function(t){var a=Object(E.a)(e.props.connectorValues);a.splice(t,1),e.props.onChange(a)},e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.updateProductPreviews(),function(){var t=Object(o.a)(i.a.mark((function t(){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(e.props.sdk.parameters.installation);case 2:a=t.sent,e.setState({moltin:a});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}},{key:"componentDidUpdate",value:function(e){var t=e.connectorValues;if(!X()(this.props.connectorValues,t)){var a=this.props.connectorValues.length!==t.length,n=$()(this.props.connectorValues,t).length>0,r=a||n;this.updateProductPreviews(r)}}},{key:"render",value:function(){return Object(j.jsx)("div",{className:this.props.className,children:Object(j.jsx)(ce,{moltin:this.state.moltin,onSortStart:function(e,t){return t.preventDefault()},onSortEnd:this.onSortEnd,axis:"xy",deleteFn:this.deleteItem,productPreviews:this.state.productPreviews,useDragHandle:!0})})}}]),a}(n.Component)),ie=a.p+"static/media/logo.0789f3c0.svg",oe=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={value:e.fieldValueToState(e.props.sdk.field.getValue())},e.updateStateValue=function(t){if(e.setState({value:t},e.recalculateHeight),t.length>0){var a="Array"===e.props.sdk.field.type?t:t[0];e.props.sdk.field.setValue(a)}else e.props.sdk.field.removeValue()},e.onDialogOpen=Object(o.a)(i.a.mark((function t(){var a,n,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.props.sdk,t.next=3,a.dialogs.openCurrentApp({allowHeightOverflow:!0,position:"center",title:"Select Product",shouldCloseOnOverlayClick:!0,shouldCloseOnEscapePress:!0,parameters:Object(u.a)(Object(u.a)({},a.parameters.installation),{},{fieldValue:e.fieldValueToState(a.field.getValue()),fieldType:a.field.type,fieldId:a.field.id}),width:1400,minHeight:700});case 3:n=t.sent,(r=Array.isArray(n)?n:[]).length&&e.updateStateValue(r);case 6:case"end":return t.stop()}}),t)}))),e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.recalculateHeight()}},{key:"recalculateHeight",value:function(){var e=this.state.value.length+1;this.props.sdk.window.updateHeight(90*e)}},{key:"fieldValueToState",value:function(e){return e?Array.isArray(e)?e:[e]:[]}},{key:"render",value:function(){var e,t=this.state.value,a=t.length>0,n=this.props.sdk.parameters.installation;if(e="product"===n.productType?C:U,n)return Object(j.jsxs)("div",{className:"ep-product-preview-wrapper",children:[a&&Object(j.jsx)(se,{connectorValues:t,className:"ep-product-preview",fetchProductPreviews:function(t){return e(t,n)},sdk:this.props.sdk,onChange:this.updateStateValue}),Object(j.jsxs)("div",{className:"ep-connector-container",children:[Object(j.jsx)("img",{src:ie,alt:"Logo",className:"ep-logo"}),Object(j.jsx)(f.a,{icon:"ShoppingCart",buttonType:"muted",size:"small",onClick:this.onDialogOpen,children:"Array"!==this.props.sdk.field.type?"Select product":"Select products"})]})]})}}]),a}(n.Component),le=a(96),ue=a(95),pe=a.n(ue),de=function(e){var t=e.onSelectProduct,a=e.product,n=e.selectedProducts,r=e.moltin,c=n.includes(a.connectorValue),s=ae(r,a).imageUrl;return Object(j.jsx)("div",{className:"ep-product-wrapper",children:Object(j.jsxs)("div",{"data-test-id":"product-preview-".concat(a.connectorValue),role:"switch","aria-checked":c,tabIndex:-1,className:"ep-product ".concat(c?"ep-selected-product":""),onKeyUp:pe.a,onClick:function(){return e=a.connectorValue,void(t&&t(e));var e},children:[Object(j.jsx)("div",{className:"ep-product-image-wrapper",children:Object(j.jsx)("img",{style:{display:"block"},src:Y(s),alt:"product preview",className:"ep-product-image-preview","data-test-id":"image"})}),Object(j.jsx)("p",{className:"ep-product-name",children:a.name}),Object(j.jsx)("p",{className:"ep-product-connectorValue",children:a.connectorValue})]})})},he=(a(90),-888),me=function(e,t){var a=t-e+1;return Array.from({length:a},(function(t,a){return a+e}))},fe=function(e){var t=e.allProductsList,a=e.sdk,r=Object(n.useState)(!1),c=Object(te.a)(r,2),s=c[0],l=c[1],u=Object(n.useState)(t),p=Object(te.a)(u,2),d=p[0],h=p[1],m=Object(n.useState)(""),g=Object(te.a)(m,2),b=g[0],v=g[1],O=Object(n.useState)(1),y=Object(te.a)(O,2),P=y[0],k=y[1],C=Object(n.useState)([]),S=Object(te.a)(C,2),w=S[0],T=S[1],N=Object(n.useState)(),V=Object(te.a)(N,2),I=V[0],L=V[1],M=Object(n.useMemo)((function(){return new le.a(t,{keys:["name","sku"],minMatchCharLength:1,threshold:.4})}),[t]);Object(n.useEffect)((function(){var e="Array",t=[],n=a.parameters.invocation;e=n.fieldType,t=n.fieldValue,T(t),l("Array"===e),function(){var e=Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(a.parameters.installation);case 2:t=e.sent,L(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[a]),Object(n.useEffect)((function(){var e=b?M.search(b).map((function(e){return e.item})):t;h(e)}),[b,t,M]);var A=Object(n.useMemo)((function(){return Object(D.debounce)((function(e){v(e),k(1)}))}),[]),R=function(e){var t=e.totalCount,a=e.pageSize,r=e.siblingCount,c=void 0===r?1:r,s=e.currentPage;return Object(n.useMemo)((function(){var e=Math.ceil(t/a);if(e<=c+5)return me(1,e);var n=Math.max(s-c,1),r=Math.min(s+c,e),i=n>2,o=r<e-2,l=1,u=e;if(!i&&o){var p=me(1,3+2*c);return[].concat(Object(E.a)(p),[-999,e])}if(i&&!o){var d=me(e-(3+2*c)+1,e);return[l,he].concat(Object(E.a)(d))}if(i&&o){var h=me(n,r);return[l,he].concat(Object(E.a)(h),[-999,u])}return[]}),[t,a,c,s])}({currentPage:P,pageSize:24,totalCount:d.length,siblingCount:1}),q=function(e){k(e)},_=function(e){return s?(t=w.includes(e)?Object(E.a)(w).filter((function(t){return t!==e})):[].concat(Object(E.a)(w),[e]),T(t)):w[0]===e?T([]):T([e]);var t},F=R[R.length-1],U=d.slice(24*(P-1),24*P);return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("header",{className:"ep-gallery-header",children:[Object(j.jsxs)("div",{className:"ep-gallery-controls",children:[Object(j.jsx)(f.o,{placeholder:"Search by SKU...",type:"search",name:"connectorValue-search",id:"connectorValue-search",testId:"connectorValue-search",value:"",width:"medium",className:"ep-gallery-search-box",onKeyUp:function(e){return A(e.target.value)}}),Object(j.jsx)(f.g,{color:"muted",icon:"Search",className:"ep-gallery-search-icon"})]}),Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"ep-gallery-controls-right",children:[Object(j.jsx)(f.a,{className:"control",buttonType:"primary",onClick:function(){a.close([""])},children:"Clear"}),Object(j.jsx)(f.a,{className:"control",buttonType:"primary",onClick:function(){a.close(w)},disabled:0===w.length,children:s?function(){var e=w.length;switch(e){case 0:return"Save (No products Selected)";case 1:return"Save 1 product";default:return"Save ".concat(e," products")}}():"Save"})]})})]}),Object(j.jsxs)("section",{children:[Object(j.jsx)("div",{className:"ep-gallery-list",children:d.length>0&&U.map((function(e,t){return Object(j.jsx)(de,{product:e,selectedProducts:w,onSelectProduct:_,sdk:a,moltin:I},t)}))}),Object(j.jsx)("nav",{"aria-label":"Pages",children:Object(j.jsxs)("ul",{className:"ep-pagination",children:[Object(j.jsx)("li",{className:"page-item",children:Object(j.jsx)(f.a,{buttonType:"muted",size:"small",onClick:function(){return q(P>1?P-1:P)},children:"<"})}),R.map((function(e){return-888===e||-999===e?Object(j.jsx)("li",{className:"page-item",children:"..."},e):Object(j.jsx)("li",{className:"page-item".concat(P===e?" active":""),children:Object(j.jsx)(f.a,{buttonType:P===e?"primary":"muted",size:"small",onClick:function(){return q(e)},children:e})},e)})),Object(j.jsx)("li",{className:"page-item",children:Object(j.jsx)(f.a,{buttonType:"muted",size:"small",onClick:function(){return q(P<F?P+1:P)},children:">"})})]})})]})]})},ge=a(45),je="LEFT",be="RIGHT",ve=function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=e,r=[];n<=t;)r.push(n),n+=a;return r},Oe=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).pageLimit=void 0,n.totalRecords=void 0,n.pageNeighbours=void 0,n.totalPages=void 0,n.fetchPageNumbers=function(){var e=n.totalPages,t=n.state.currentPage,a=n.pageNeighbours,r=2*n.pageNeighbours+3;if(e>r+2){var c=Math.max(2,t-a),s=Math.min(e-1,t+a),i=ve(c,s),o=c>2,l=e-s>1,u=r-(i.length+1);switch(!0){case o&&!l:var p=ve(c-u,c-1);i=[je].concat(Object(E.a)(p),Object(E.a)(i));break;case!o&&l:var d=ve(s+1,s+u);i=[].concat(Object(E.a)(i),Object(E.a)(d),[be]);break;case o&&l:default:i=[je].concat(Object(E.a)(i),[be])}return[1].concat(Object(E.a)(i),[e])}return ve(1,e)},n.gotoPage=function(e){var t=n.props.onPageChanged,a=void 0===t?function(e){return e}:t,r=Math.max(0,Math.min(e,n.totalPages)),c={currentPage:r,totalPages:n.totalPages,pageLimit:n.pageLimit,totalRecords:n.totalRecords};n.setState({currentPage:r},(function(){return a(c,Object(ge.a)(n))}))},n.handleClick=function(e){return function(t){t.preventDefault(),n.gotoPage(e)}},n.handleMoveLeft=function(e){e.preventDefault(),n.gotoPage(n.state.currentPage-2*n.pageNeighbours-1)},n.handleMoveRight=function(e){e.preventDefault(),n.gotoPage(n.state.currentPage+2*n.pageNeighbours+1)},n.pageLimit=0,n.totalRecords=0,n.pageNeighbours=0,n.totalPages=0,n.calculatePages(),n.state={currentPage:1},n}return Object(d.a)(a,[{key:"calculatePages",value:function(){var e=this.props,t=e.totalRecords,a=void 0===t?null:t,n=e.pageLimit,r=void 0===n?30:n,c=e.pageNeighbours,s=void 0===c?0:c;this.pageLimit=r||30,this.totalRecords=a||0,this.pageNeighbours=s?Math.max(0,Math.min(s,2)):0,this.totalPages=Math.ceil(this.totalRecords/this.pageLimit)}},{key:"componentDidMount",value:function(){this.gotoPage(1)}},{key:"render",value:function(){var e=this;if(this.calculatePages(),!this.totalRecords||1===this.totalPages)return null;var t=this.state.currentPage,a=this.fetchPageNumbers();return Object(j.jsx)("nav",{"aria-label":"Countries Pagination",children:Object(j.jsx)("ul",{className:"ep-pagination",children:a.map((function(a,n){return a===je?Object(j.jsx)("li",{className:"page-item",children:Object(j.jsxs)(f.a,{buttonType:"muted","aria-label":"Previous",onClick:e.handleMoveLeft,children:[Object(j.jsx)("span",{"aria-hidden":"true",children:"\xab"}),Object(j.jsx)("span",{className:"sr-only",children:"Previous"})]})},n):a===be?Object(j.jsx)("li",{className:"page-item",children:Object(j.jsxs)(f.a,{buttonType:"muted","aria-label":"Next",onClick:e.handleMoveRight,children:[Object(j.jsx)("span",{"aria-hidden":"true",children:"\xbb"}),Object(j.jsx)("span",{className:"sr-only",children:"Next"})]})},n):Object(j.jsx)("li",{className:"page-item".concat(t===a?" active":""),children:Object(j.jsx)(f.a,{buttonType:t===a?"primary":"muted",size:"small",onClick:e.handleClick(a),children:a})},n)}))})})}}]),a}(n.Component),xe=24,ye=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).allowMultipleSelection=!1,e.searchTimout=void 0,e.state={productList:[],searchTerm:"",searchCategoryId:"",searchCollectionId:"",searchCategories:[],searchCollections:[],offsetItems:0,currentPage:1,loading:!0,paginationObject:{},selectedProducts:[],moltin:null},e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e,t,a=this,n=[],r=this.props.sdk.parameters.invocation;t=r.fieldType,n=r.fieldValue,this.setState({selectedProducts:n}),this.allowMultipleSelection="Array"===t;var c=this.props.sdk.parameters.installation;xe=c.itemsPerPage?parseInt(c.itemsPerPage):24,this.performSearch(),this.populateSelects();var s=Object(O.gateway)({client_id:this.props.sdk.parameters.installation.clientId,host:null===(e=this.props.sdk.parameters.installation.host)||void 0===e?void 0:e.replace("https://","")});s.Authenticate().then((function(){a.setState({moltin:s})}))}},{key:"populateSelects",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(this.props.sdk.parameters.installation);case 2:return t=e.sent,e.next=5,A(this.props.sdk.parameters.installation);case 5:a=e.sent,this.setState({searchCategories:t,searchCollections:a});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSearchByTerm",value:function(e){var t=this;this.searchTimout&&clearTimeout(this.searchTimout),this.searchTimout=setTimeout((function(){t.setState({searchTerm:e},t.performSearch)}),300)}},{key:"performSearch",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(this.state.searchTerm,this.state.searchCategoryId,this.state.searchCollectionId,this.props.sdk.parameters.installation);case 2:t=e.sent,0!==this.state.currentPage&&this.state.paginationObject instanceof Oe&&this.state.paginationObject.gotoPage(1),this.setState({productList:t,loading:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onSearchByCategory",value:function(e){var t=e.currentTarget.value;this.setState({searchCategoryId:t},this.performSearch)}},{key:"onSearchByCollection",value:function(e){var t=e.currentTarget.value;this.setState({searchCollectionId:t},this.performSearch)}},{key:"onPageChanged",value:function(e,t){var a,n=((null!==(a=e.currentPage)&&void 0!==a?a:0)-1)*xe,r=e.currentPage*xe;this.setState({offsetItems:n,currentPage:r,paginationObject:t})}},{key:"onSelectProduct",value:function(e){var t,a=this;t=this.state.selectedProducts.includes(e)?this.state.selectedProducts.filter((function(t){return t!==e})):[].concat(Object(E.a)(this.state.selectedProducts),[e]),this.allowMultipleSelection?this.setState({selectedProducts:t}):this.setState({selectedProducts:[e]},(function(){return a.saveSelected()}))}},{key:"saveSelected",value:function(){this.props.sdk.close(this.state.selectedProducts)}},{key:"isLastPageSelected",value:function(){var e=this.state.productList.length-this.state.offsetItems;return e<xe&&e===this.state.selectedProducts.length}},{key:"selectAll",value:function(){if(this.allowMultipleSelection&&this.state.selectedProducts.length<xe){var e,t=xe+this.state.offsetItems,a=this.state.productList.slice(this.state.offsetItems,t),n=[],r=Object(v.a)(a);try{for(r.s();!(e=r.n()).done;){var c=e.value;n.push(c.connectorValue)}}catch(s){r.e(s)}finally{r.f()}this.setState({selectedProducts:n})}(this.state.selectedProducts.length===xe||this.isLastPageSelected())&&this.selectNone()}},{key:"selectNone",value:function(){this.setState({selectedProducts:[]})}},{key:"saveButtonLabel",value:function(){var e=this.state.selectedProducts.length;switch(e){case 0:return"Save products";case 1:return"Save 1 product";default:return"Save ".concat(e," products")}}},{key:"selectAllButtonLabel",value:function(){return this.state.selectedProducts.length===xe||this.isLastPageSelected()?"Select None":"Select All"}},{key:"render",value:function(){var e=this;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)("header",{className:"ep-gallery-header",children:["product"===this.props.sdk.parameters.installation.productType&&Object(j.jsxs)("div",{className:"ep-gallery-controls",children:[Object(j.jsx)(f.o,{placeholder:"Search by SKU",type:"search",name:"connectorValue-search",id:"connectorValue-search",testId:"connectorValue-search",value:"",width:"medium",className:"ep-gallery-search-box",onKeyUp:function(t){return e.onSearchByTerm(t.target.value)}}),Object(j.jsx)(f.g,{color:"muted",icon:"Search",className:"ep-gallery-search-icon"}),Object(j.jsxs)(f.k,{value:this.state.searchCategoryId,onChange:this.onSearchByCategory.bind(this),children:[Object(j.jsx)(f.i,{value:"",children:"Select a category"}),this.state.searchCategories.length>0&&this.state.searchCategories.map((function(e,t){return Object(j.jsx)(f.i,{value:e.id,children:e.name},t)}))]}),Object(j.jsxs)(f.k,{value:this.state.searchCollectionId,onChange:this.onSearchByCollection.bind(this),children:[Object(j.jsx)(f.i,{value:"",children:"Select a collection"}),this.state.searchCollections.length>0&&this.state.searchCollections.map((function(e,t){return Object(j.jsx)(f.i,{value:e.id,children:e.name},t)}))]})]}),"pcm"===this.props.sdk.parameters.installation.productType&&Object(j.jsxs)("div",{className:"ep-gallery-controls",children:[Object(j.jsx)(f.o,{placeholder:"Enter exact SKU ...",type:"search",name:"connectorValue-search",id:"connectorValue-search",testId:"connectorValue-search",value:"",width:"medium",className:"ep-gallery-search-box",onKeyUp:function(t){return e.onSearchByTerm(t.target.value)}}),Object(j.jsx)(f.g,{color:"muted",icon:"Search",className:"ep-gallery-search-icon"})]}),this.allowMultipleSelection&&Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"ep-gallery-controls-right",children:[Object(j.jsx)(f.a,{buttonType:"primary",onClick:this.selectAll.bind(this),children:this.selectAllButtonLabel()}),Object(j.jsx)("span",{children:"\xa0"}),Object(j.jsx)(f.a,{buttonType:"primary",onClick:this.saveSelected.bind(this),children:this.saveButtonLabel()})]})})]}),Object(j.jsxs)("section",{children:[Object(j.jsxs)("div",{className:"ep-gallery-list",children:[this.state.productList.length>0&&!this.state.loading&&this.state.productList.slice(this.state.offsetItems,this.state.currentPage).map((function(t,a){return Object(j.jsx)(de,{product:t,selectedProducts:e.state.selectedProducts,onSelectProduct:e.onSelectProduct.bind(e),sdk:e.props.sdk,moltin:e.state.moltin},a)})),this.state.loading&&Object(j.jsx)(f.d,{headingProps:{text:"Loading..."},descriptionProps:{text:"Please wait while the product list loads."}}),!this.state.loading&&this.state.productList.length<1&&Object(j.jsx)(f.d,{headingProps:{text:"No product found..."},descriptionProps:{text:"Please try searching again using different terms."}})]}),this.state.productList.length>0&&Object(j.jsx)(Oe,{totalRecords:this.state.productList.length,pageLimit:xe,pageNeighbours:2,onPageChanged:this.onPageChanged.bind(this)})]})]})}}]),a}(n.Component),Pe=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={productList:[],config:e.props.sdk.parameters.installation},e.integrationType=e.props.sdk.parameters.installation.productType,e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.fetchProducts()}},{key:"getLegacyProducts",value:function(){var e=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C([],this.props.sdk.parameters.installation);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPCMProducts",value:function(){var e=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U([],this.props.sdk.parameters.installation);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchProducts",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.sdk.parameters.installation,"product"!==t.productType){e.next=8;break}return e.next=5,this.getLegacyProducts();case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,this.getPCMProducts();case 10:e.t0=e.sent;case 11:a=e.t0,this.setState((function(){return{productList:a}}));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return"product"===this.state.config.productType?Object(j.jsx)(ye,{productList:this.state.productList,sdk:this.props.sdk}):Object(j.jsx)(fe,{allProductsList:this.state.productList,sdk:this.props.sdk})}}]),a}(n.Component);Object(c.init)((function(e){var t=document.getElementById("root");[{location:c.locations.LOCATION_APP_CONFIG,component:Object(j.jsx)(b,{sdk:e})},{location:c.locations.LOCATION_ENTRY_FIELD,component:Object(j.jsx)(oe,{sdk:e})},{location:c.locations.LOCATION_DIALOG,component:Object(j.jsx)(Pe,{sdk:e})}].forEach((function(a){e.location.is(a.location)&&Object(r.render)(a.component,t)}))}))},90:function(e,t,a){}},[[248,1,2]]]);
//# sourceMappingURL=main.dface275.chunk.js.map